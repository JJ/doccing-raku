<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    
    <title>Doccing Raku -- P&R in the cloud</title>

    <link rel="stylesheet" href="dist/reset.css">
    <link rel="stylesheet" href="dist/reveal.css">
    <link rel="stylesheet" href="dist/extra.css">
    <link rel="stylesheet" href="dist/doccing-raku.css" id="theme">
    
    <!-- Theme used for syntax highlighted code -->
    <link rel="stylesheet" href="plugin/highlight/monokai.css" id="highlight-theme">
  </head>
  <body>
    <div class="reveal">
      <div class="slides">
	<section data-background='https://live.staticflickr.com/65535/47653177222_f16ca4971e_o_d.jpg'><h1>‚úé Doccing Rakuüñä</h1>
	  <h2><code>@jjmerelo</code>, <code>github.com/JJ</code></h2>
	</section>

	<section data-background='https://live.staticflickr.com/4757/40260012261_a2c7f7828a_k_d.jpg'>
	  <h1>Raku Doccer in (Mis)Chief</h1>
          <h2 class='fragment'>Writer of Important Things</h2>
          <h3 class='fragment'>‚áí You work out the acronym</h3>
	  <aside class='notes'>From a experience with students that created their own language, that's the post-it.</aside>
	</section>

            <section
      data-background='https://live.staticflickr.com/65535/50015745537_18de123214_k_d.jpg'>
	      <h1>üìñüìö‚ùó‚ùó</h1>
	      <aside class='notes'>I write books!</aside>
            </section>

            <section data-background='https://live.staticflickr.com/65535/48162431861_08b5c69aec_k_d.jpg'><h2>3 parts</h2>
	      <h3 class='fragment'>Doc project</h3>
	      <h2 class='fragment'>Doc all things</h2>
	      <h3 class='fragment'>1 || 2 futures</h3>
	    </section>


	    <section data-background='https://live.staticflickr.com/4304/35578237540_5bc53058f4_k_d.jpg'>
	  <h1>Documentation is important</h1></section>

	<section data-background='https://live.staticflickr.com/54/116855446_2a865262c0_o_d.jpg'>
	  <h1>HOW do you do it? ü§î</h1>
	</section>

	<section>

          <section
      data-background='https://live.staticflickr.com/65535/48610282091_a24e835876_k_d.jpg'>
      <pre><code>=begin pod :kind("Type") :subkind("class") :category("exception")

=TITLE class Failure

=SUBTITLE Delayed exception

    class Failure is Nil { }

A C&lt;Failure> is a I&lt;soft> or I&lt;unthrown> L&lt;Exception|/type/Exception>,
usually generated by calling C&lt;&fail>. It acts as a wrapper around an
L&lt;Exception|/type/Exception> object.

=for comment
A lot of more stuff here

=end pod
      </code></pre>
      <aside class='notes'>This is the raw material, what we have to use. What's great about this, is that we have content, structure _and_ metadata using Raku itself. Documentation is what's called a "braid" or a specific language within Raku, same as regular expressions or quotes. (The concept of braid is a documentation page that needs to be written, BTW)</aside>
	  </section>

    <section data-background='img/menu.png'><h1>Searchable</h1>
    </section>
    
    <section
      data-background='img/googled.png'><h1>Findable</h1></section>

    <section
      data-background='img/indexed.png'><h1>Indexable</h1></section>

    <section
      data-background='img/reference.png'><h1>Referenceable</h1></section>

    <section><h1>We need <code>Documentable</code></h1>

    <pre><code>#| Everything documented inherits from this class
class Documentable {

    has Str  $.name;
    has      $.pod  is required("Needs an actual document");
    has Kind $.kind is required("Is essential metadata");
    has      @.subkinds   = [];
    has      @.categories = [];
    </code></pre>
    </section>

</section>

	<section> <!-- nuts and bolts -->
<section
  data-background='https://live.staticflickr.com/1867/44364696462_94fb8772b8_k_d.jpg'>
  <h1>üïÆ Literary programming üïÆ</h1>
  <aside class='notes'>Because we're actually processing with the same
  compiler as the rest of the program, and producing an AST for both
    at the same time</aside>
</section>

<section data-background='https://live.staticflickr.com/65535/50043721022_2461caf549_k_d.jpg'><h2>Documentation is <strong>precompiled</strong>  </h2>
  <h3 class='fragment'>Work by Antonio G√°miz based on Richard Heinsworth's <code>Pod::To::Cached</code></h3>

	</section>

<section><h1>Register everything</h1>
  <pre><code>        my $registry = Documentable::Registry.new(
            :$topdir,
            :dirs( $doc-dirs ),
            :$typegraph-file
            :verbose($v)
        );
        $registry.compose; </code></pre>  
	</section>

<section><h1>Use the cache, Luke</h1>
  <pre><code>    if ( $!use-cache ) {
        $!pod-cache = init-cache( $!topdir, $!verbose);
        say "Updating cache";
        $!pod-cache.update-cache;
    }
  </code></pre>
</section>

<section data-background='https://live.staticflickr.com/52/108813260_d7840ae7d1_o_d.jpg'>
  <h1>Parse, index, repeat</h1></section>

<section><h1>Generate HTML</h1>
  <pre><code>my %pod-to-render = Documentable::DocPage::Secondary.new.render($!registry, $name, $kind);
        my Str $html = $!wrapper.render( %pod-to-render<document>,
                                         $kind.Str,
                                        );
        return %(
            document => $html,
            url      => %pod-to-render<url>
        )</code></pre>
</section>

<section><h1>Generation</h1>
  <img src='img/documentable.png' title='generating documentation'>
</section>

<section data-background='https://live.staticflickr.com/65535/40678486313_2d33c5c8c3_k_d.jpg'>
  <h1>Ship it</h1>
  <pre><code>rsync -avu -e .
    docs.raku.org@xxx.atikon.io:/var/www/docs.raku.org/
</code></pre>
<h3 class='fragment'>With thanks to Roman Baumer and the Atikon people providing this infra</h3>
<aside class='notes'>It's totally static now, which is a good thing, security wise, but also makes deployment relatively simple; other than a bit of NGINX configuration tweaking, there's not much.</aside>
</section>
	</section>
<section><h1>HOW do you write it? ¬Ø\_(„ÉÑ)_/¬Ø</h1></section>
<section>
  <section data-background='https://live.staticflickr.com/2486/4172052945_f3f238abe0_k_d.jpg'><h1><strong>Find</strong> out about it</h1>
  </section>

  <section><h1>Parse ChangeLogs</h1>
<pre><code> use LWP::Simple;
my $release = @*ARGS[0] // "2019.03";
my $document = LWP::Simple.get("https://raw.githubusercontent.com/rakudo/rakudo/master/docs/announce/$release.md");
my @parts = $document.split("\n  +");
my $additions-removals = @parts[1,2,3].map: "\n# " ~ * ;
$additions-removals ~~  s:g/\s\s\s\+\s/* [ ] /;
$additions-removals ~~
    s:g[ \[(&lt;alnum>+)\] ] =
    "-[$0](https://github.com/rakudo/rakudo/commit/$0)";
    print $additions-removals;</code></pre>
<aside class='notes'>It's important to have the commits handy, and very grateful to Rakudo developers for including them in the Changelog. It really helps find out what's been changed.</aside>
  </section>
  
<section><h1>Use the <strong>source</strong> and context</h1>
  <img src='img/code.png' alt='(mostly) NQP code for something'>
  <aside class='notes'>That gives you the signature, and a general reference. Then you need to understand what it actually does by understanding the source.
    New releases already include the commit number in the changelog, but old ones don't, and you have to play detective a bit.</aside>

</section>

<section><h1><code>Blame</code> helps with context</h1>
  <img src='img/blame.png' title='blame for code'>
</section>

<section><h1>With helpful commit messages</h1>
  <img src='img/commit.png' title='Helpful commit'>
</section>

  <section> <h2> Spec ‚â† Rakudo ‚â† Implementation</h2>

  <pre><code># https://github.com/rakudo/rakudo/issues/2568
{
    is-deeply 3 ~ ( 5 | "18" ), any("35","318"),
      "does a junction survive ~ Junction";
    is-deeply ( 5 | "18" ) ~ 3, any("53","183"),
      "does a junction survive Junction ~";
    is-deeply ( 5 | "18" ) ~ ( 3 | 6), any("53","56","183",186),
      "does a junction survive Junction ~ Junction";
}</code></pre>
  <aside class='notes'>This is roast, which is spec. And it also provides helpful examples.</aside>
  </section>

  <section data-background='https://live.staticflickr.com/7810/47348652912_e7ad757ba9_k_d.jpg'>
    <h1><strong>Understand</strong> what it does</h1> </section>

  <section> <h1> Produce examples </h1>
    <h2 class='fragment'>Go viral</h2>
    <pre><code>my &fail-routine = &fail;
unless &fail-routine.is-implementation-detail {
    say "&fail is not an implementation detail, can expect backward compatibility";
}
sub PRIVATE-CALCULATION is implementation-detail {
	#`(Not safe to rely on this)
}
if &PRIVATE-CALCULATION.is-implementation-detail {
        say "You better not to rely on &PRIVATE-CALCULATION unless you really know what you are doing";
}
    </code></pre>
	<aside class='notes'>Think about it. Your code is going to be pasted over and over again, for ever. This was added quite recently, after the addition in the 2020.05 version of this thing that clarifies what's and what's not an implementation detail. Also, this was just deployed, after being added by Alexei Kiryukhin a few days ago. This example, as a matter of fact, provides syntax _and_ intent, whihc is the most important thing. Examples should show why something would have to be used.</aside>
  </section>

</section>

<section><h1>100k lines of documentation</h1>
  <h1 class='fragment'>13.5K commits</h1>
  <h2 class='fragment'> 262 contributors (37 last 12 mo)</h2>
  <aside class='notes'>Some time during quarantine, we passed over the 100k line. Documentation is a collective effort, and lots of people are doing amazing work here.</aside></section>

<section>
  <section data-background='https://live.staticflickr.com/4834/32760152498_0e2623f0f8_k_d.jpg'><h1>Looking at the future</h1></section>

  <section data-background='https://live.staticflickr.com/4036/4519638695_15a3bbad5b_k_d.jpg'><h1>More automation</h1>
    <h2 class='fragment'>Save boilerplate writing.</h2>
    <aside class='notes'>For instance, just point at something and have it write the intro to a method for you, or automatically test-compile examples when you're done with them. Right now, there are too many manual steps in the process.</aside>
  </section>

  <section data-background='https://live.staticflickr.com/8522/8643467808_9efb856d14_o_d.jpg'><h1>The Great Unification of Docs</h1>
    <h2>That's gonna be GUD</h2>
    <aside class='notes'>Documentation tooling, and documentable, were written specifically for the documentation. </aside>
  </section>

  <section data-background='https://live.staticflickr.com/1119/1026173527_f5959692f2_3k_d.jpg'>
    <h1>Streamline release/deployment</h1>
    <aside class='notes'>There are no releases to speak of, but tooling and format should really use it, so that now that tooling and content is separated, they integrate well together. But also deployment, it should be automated and as fast as possible. Needs some tooling on the server side, and we'd like to do it well. It's easy, but needs to be done.</aside>
  </section>
</section>

<section><h1>Raku is an amazing language</h1></section>
<section data-background='https://live.staticflickr.com/65535/48549954721_0a93aa703f_k_d.jpg'>
  <h1>Documentation needs to be amazing too</h1></section>

      </div>
		</div>

		<script src="dist/reveal.js"></script>
		<script src="plugin/notes/notes.js"></script>
		<script src="plugin/markdown/markdown.js"></script>
		<script src="plugin/highlight/highlight.js"></script>
		<script>
			// More info about initialization & config:
			// - https://revealjs.com/initialization/
			// - https://revealjs.com/config/
			Reveal.initialize({
				hash: true,
                          width: "95%",
                          history: true,
				// Learn about plugins: https://revealjs.com/plugins/
				plugins: [ RevealMarkdown, RevealHighlight, RevealNotes ]
			});
		</script>
	</body>
</html>
